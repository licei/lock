<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>THE WATCHING ARCHIVE — DIAGNOSTICS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;color:#b00000;font-family:monospace;overflow:hidden}
#loading{position:fixed;inset:0;background:#000;z-index:9999;display:flex;align-items:center;justify-content:center}
#loading h1{font-size:48px;letter-spacing:6px;animation:glitch .7s infinite}
@keyframes glitch{0%{text-shadow:3px 3px red}50%{text-shadow:-3px -3px darkred}100%{text-shadow:3px 3px red}}

#eyeWrap{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1}
#eye{width:280px;height:280px;background:#7a0000;border-radius:50%;position:relative;overflow:hidden}
#lid{position:absolute;top:-280px;width:100%;height:280px;background:#000;animation:blink 4s infinite}
@keyframes blink{45%{top:-280px}48%{top:0}52%{top:0}55%{top:-280px}}
#pupil{width:80px;height:80px;background:#000;border-radius:50%;position:absolute;top:100px;left:100px}

.little-eye{position:absolute;width:46px;height:46px;border-radius:50%;background:#6a0000;overflow:hidden;opacity:0;transition:opacity .3s}
.little-eye .p{width:14px;height:14px;background:#000;border-radius:50%;position:absolute;top:16px;left:16px}
.peek{opacity:1}

#fog{position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(circle at 50% 50%, transparent 55%, rgba(120,0,0,.45) 100%);animation:fog 5s infinite alternate}
@keyframes fog{from{opacity:.25}to{opacity:.55}}

#panel{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);width:92%;max-width:900px;background:rgba(0,0,0,.9);border:1px solid #600;padding:10px;z-index:2}
#messages{height:240px;overflow-y:auto;border-bottom:1px solid #600;margin-bottom:6px;padding:4px}
.msg{margin-bottom:6px}
.name{color:#ff4444}
input,button{background:#000;color:#b00000;border:1px solid #600;padding:6px}
button{cursor:pointer}

#flash{position:fixed;inset:0;background:#800;opacity:0;pointer-events:none;z-index:10;transition:opacity .15s}
.shake{animation:shake .15s}
@keyframes shake{0%{transform:translate(0)}25%{transform:translate(3px)}50%{transform:translate(-3px)}75%{transform:translate(3px)}100%{transform:translate(0)}}

#screamer{position:fixed;inset:0;background:#000;display:none;align-items:center;justify-content:center;z-index:20}
#screamer img{width:100%;height:100%;object-fit:cover}
</style>
</head>
<body>

<div id="loading"><h1>DIAGNOSTIC MODE</h1></div>
<div id="fog"></div>
<div id="flash"></div>

<div id="eyeWrap">
  <div id="eye">
    <div id="lid"></div>
    <div id="pupil"></div>
    <div class="little-eye" style="top:-10px;left:-10px"><div class="p"></div></div>
    <div class="little-eye" style="top:20px;right:-12px"><div class="p"></div></div>
    <div class="little-eye" style="bottom:-12px;left:30px"><div class="p"></div></div>
  </div>
</div>

<div id="panel">
  <div id="messages"></div>
  <input id="text" placeholder="сообщение будет архивировано">
  <button onclick="send()">SEND</button>
</div>

<div id="screamer"><img id="screamerImg" src="https://i.imgur.com/4AiXzf8.png"></div>

<audio id="scream1" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6c1fd8a2b2.mp3"></audio>
<audio id="scream2" src="https://cdn.pixabay.com/audio/2021/08/04/audio_7a2d1a7b3f.mp3"></audio>
<audio id="whisper" src="https://cdn.pixabay.com/audio/2021/09/01/audio_35e3c0d5f2.mp3" loop></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
setTimeout(()=>loading.style.display='none',2500);
whisper.volume=.25; whisper.play();

const pupil=document.getElementById('pupil');
const eye=document.getElementById('eye');
document.addEventListener('mousemove',e=>{
  const r=eye.getBoundingClientRect();
  pupil.style.left=Math.max(20,Math.min(180,e.clientX-r.left-40))+'px';
  pupil.style.top=Math.max(20,Math.min(180,e.clientY-r.top-40))+'px';
});

const littles=[...document.querySelectorAll('.little-eye')];
setInterval(()=>{
  littles.forEach(le=>le.classList.remove('peek'));
  const pick=littles[Math.floor(Math.random()*littles.length)];
  pick.classList.add('peek');
  setTimeout(()=>pick.classList.remove('peek'),800);
}, Math.random()*4000+3000);

let identity=localStorage.getItem('entity_name');
if(!identity){
  identity='entity_'+Math.random().toString(36).slice(2,10);
  localStorage.setItem('entity_name',identity);
}

const firebaseConfig = {
  apiKey: "AIzaSyCbKw_YRxf38AxxqcKMfIvg9KqDTQxKzTU",
  authDomain: "licei-47857.firebaseapp.com",
  databaseURL: "https://licei-47857-default-rtdb.firebaseio.com",
  projectId: "licei-47857",
  storageBucket: "licei-47857.firebasestorage.app",
  messagingSenderId: "693615263006",
  appId: "1:693615263006:web:e9309536d58ae848b49d0f"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const messagesRef=db.ref('messages');
const diagnosticsRef=db.ref('diagnostics');

const box=document.getElementById('messages');
messagesRef.limitToLast(300).on('child_added',snap=>{
  const m=snap.val();
  box.innerHTML+=`<div class="msg"><span class="name">[${m.name}]</span> ${m.text}</div>`;
  box.scrollTop=9999;
});

function send(){
  const t=text.value.trim();
  if(!t)return;
  messagesRef.push({name:identity,text:t,time:Date.now()});
  text.value='';
  flash();
}

const flashEl=document.getElementById('flash');
function flash(){
  flashEl.style.opacity=1;
  document.body.classList.add('shake');
  setTimeout(()=>{flashEl.style.opacity=0;document.body.classList.remove('shake')},150);
}

const screamers=[
  {img:'https://i.imgur.com/4AiXzf8.png',sound:scream1},
  {img:'https://i.imgur.com/2nCt3Sbl.jpg',sound:scream2},
  {img:'https://i.imgur.com/9QZ7ZyF.jpg',sound:scream1}
];
function randomScreamer(){
  const s=document.getElementById('screamer');
  const img=document.getElementById('screamerImg');
  const pick=screamers[Math.floor(Math.random()*screamers.length)];
  img.src=pick.img; pick.sound.currentTime=0; pick.sound.play();
  s.style.display='flex';
  setTimeout(()=>s.style.display='none',260);
  setTimeout(randomScreamer,Math.random()*25000+12000);
}
setTimeout(randomScreamer,15000);

/* TECHNICAL DIAGNOSTICS (NO IP, NO PERSONAL DATA) */
(function logDiagnostics(){
  const data={
    name:identity,
    userAgent:navigator.userAgent,
    platform:navigator.platform||'',
    screen:`${screen.width}x${screen.height}`,
    language:navigator.language||'',
    timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||'',
    memory:navigator.deviceMemory||null,
    cores:navigator.hardwareConcurrency||null,
    time:Date.now()
  };
  diagnosticsRef.push(data);
})();
</script>

</body>
</html>
