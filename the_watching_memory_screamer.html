<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>THE WATCHING MEMORY</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:black;color:#b00000;font-family:monospace;overflow:hidden}

/* LOADING */
#loading{
  position:fixed;inset:0;background:black;z-index:9999;
  display:flex;align-items:center;justify-content:center
}
#loading h1{
  font-size:52px;letter-spacing:8px;
  animation:glitch 0.8s infinite
}
@keyframes glitch{
  0%{text-shadow:3px 3px red}
  50%{text-shadow:-3px -3px darkred}
  100%{text-shadow:3px 3px red}
}

/* EYE */
#eyeWrap{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);z-index:1
}
#eye{
  width:280px;height:280px;
  background:#7a0000;border-radius:50%;
  position:relative;overflow:hidden
}
#lid{
  position:absolute;top:-280px;width:100%;height:280px;
  background:black;animation:blink 4s infinite
}
@keyframes blink{
  45%{top:-280px}
  48%{top:0}
  52%{top:0}
  55%{top:-280px}
}
#pupil{
  width:80px;height:80px;background:black;border-radius:50%;
  position:absolute;top:100px;left:100px
}

/* FOG */
#fog{
  position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(circle at 50% 50%, transparent 55%, rgba(120,0,0,.45) 100%);
  animation:fog 5s infinite alternate
}
@keyframes fog{from{opacity:.25}to{opacity:.55}}

/* PANEL */
#panel{
  position:fixed;bottom:10px;left:50%;
  transform:translateX(-50%);
  width:92%;max-width:900px;
  background:rgba(0,0,0,.9);
  border:1px solid #600;padding:10px;z-index:2
}
#messages{
  height:240px;overflow-y:auto;
  border-bottom:1px solid #600;margin-bottom:6px;padding:4px
}
.msg{margin-bottom:6px}
.name{color:#ff4444;animation:nameFlicker .6s infinite}
@keyframes nameFlicker{50%{opacity:.4}}
input,button{
  background:black;color:#b00000;border:1px solid #600;
  padding:6px
}
button{cursor:pointer}

/* FLASH */
#flash{
  position:fixed;inset:0;background:#800;
  opacity:0;pointer-events:none;z-index:10;
  transition:opacity .15s
}

/* SCREAMER */
#screamer{
  position:fixed;inset:0;
  background:black;display:none;
  align-items:center;justify-content:center;
  z-index:20
}
#screamer img{
  width:100%;height:100%;object-fit:cover
}
</style>
</head>
<body>

<div id="loading"><h1>IT REMEMBERS YOU</h1></div>
<div id="fog"></div>
<div id="flash"></div>

<div id="eyeWrap">
  <div id="eye">
    <div id="lid"></div>
    <div id="pupil"></div>
  </div>
</div>

<div id="panel">
  <div id="messages"></div>
  <input id="text" placeholder="оставь сообщение навсегда">
  <button onclick="send()">SEND</button>
</div>

<div id="screamer">
  <img src="https://i.imgur.com/4AiXzf8.png">
</div>

<audio id="scream" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6c1fd8a2b2.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* LOADING */
setTimeout(()=>loading.style.display='none',2600);

/* EYE FOLLOW */
const pupil=document.getElementById('pupil');
const eye=document.getElementById('eye');
document.addEventListener('mousemove',e=>{
  const r=eye.getBoundingClientRect();
  pupil.style.left=Math.max(20,Math.min(180,e.clientX-r.left-40))+'px';
  pupil.style.top=Math.max(20,Math.min(180,e.clientY-r.top-40))+'px';
});

/* RANDOM NAME */
function randomName(){
  return 'entity_'+Math.random().toString(36).slice(2,8);
}
let currentName=randomName();
setInterval(()=>currentName=randomName(),700);

/* FIREBASE CONFIG — ВСТАВЬ СВОЁ */
const firebaseConfig = {
  apiKey: "PASTE_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT.firebaseio.com",
  projectId: "PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const ref=db.ref("messages");

const box=document.getElementById('messages');
ref.limitToLast(100).on("child_added",snap=>{
  const m=snap.val();
  box.innerHTML+=`<div class="msg"><span class="name">[${m.name}]</span> ${m.text}</div>`;
  box.scrollTop=9999;
});

function send(){
  const t=text.value.trim();
  if(!t)return;
  ref.push({name:currentName,text:t,time:Date.now()});
  text.value='';
  flash();
}

/* FLASH */
function flash(){
  flashEl.style.opacity=1;
  setTimeout(()=>flashEl.style.opacity=0,150);
}
const flashEl=document.getElementById('flash');

/* RANDOM SCREAMER */
function randomScreamer(){
  const s=document.getElementById('screamer');
  const sound=document.getElementById('scream');
  s.style.display='flex';
  sound.currentTime=0;
  sound.play();
  setTimeout(()=>s.style.display='none',300);
  setTimeout(randomScreamer,Math.random()*30000+15000);
}
setTimeout(randomScreamer,20000);
</script>

</body>
</html>
